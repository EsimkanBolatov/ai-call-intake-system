# JSON Формат вывода ИИ для системы AI-колл-интейк

## Основной формат

ИИ всегда возвращает ответ в строго определённом JSON формате:

```json
{
  "urgency": "critical|high|medium|low",
  "category": "theft|assault|domestic|noise|traffic|public_order|missing_person|vandalism|fraud|fire|medical|other",
  "address": "извлеченный адрес или 'не указан'",
  "current_danger": true/false,
  "people_involved": число,
  "weapons": true/false,
  "recommended_department": "Полиция|Скорая|МЧС|Акимат",
  "summary": "краткое описание на русском (1-2 предложения)",
  "needs_clarification": true/false,
  "clarification_questions": ["вопрос1", "вопрос2"]
}
```

## Расширенный формат (после валидации)

После обработки классификатором добавляются дополнительные поля:

```json
{
  "urgency": "high",
  "category": "assault",
  "address": "ул. Абая, д. 15",
  "current_danger": true,
  "people_involved": 2,
  "weapons": false,
  "recommended_department": "Полиция",
  "summary": "Мужчина избивает женщину во дворе дома номер 15",
  "needs_clarification": false,
  "clarification_questions": [],
  "confidence_score": 0.85,
  "validated": true,
  "validation_notes": ["Текущая опасность - требуется срочное реагирование"]
}
```

## Описание полей

### urgency (срочность)

- **critical** - непосредственная угроза жизни, активное насилие, вооруженное нападение, пожар, серьезная травма
- **high** - серьезное преступление в процессе, потенциальная опасность, пропажа человека, ДТП с пострадавшими
- **medium** - преступление уже совершено, нет непосредственной угрозы, кража, вандализм, мошенничество
- **low** - незначительные нарушения, информационные сообщения, нарушение тишины, административные вопросы

### category (категория)

- **theft** - кража, грабеж, угоны
- **assault** - нападение, избиение, драка
- **domestic** - домашнее насилие, семейные конфликты
- **noise** - нарушение тишины, шум
- **traffic** - ДТП, нарушение ПДД, аварии
- **public_order** - нарушение общественного порядка, дебош, хулиганство
- **missing_person** - пропажа человека, потерявшиеся
- **vandalism** - вандализм, повреждение имущества
- **fraud** - мошенничество, киберпреступления
- **fire** - пожар, задымление
- **medical** - медицинские случаи, травмы, необходимость скорой помощи
- **other** - другие инциденты

### address (адрес)

- Формат: "ул. [название], д. [номер]" или "около [ориентир]"
- Если адрес не указан: "не указан"
- Автоматически извлекается из текста с помощью регулярных выражений

### current_danger (текущая опасность)

- **true** - опасность существует в данный момент, требуется немедленное реагирование
- **false** - инцидент произошел в прошлом, непосредственной опасности нет

### people_involved (количество участников)

- Число участников инцидента
- 0 если неизвестно
- Автоматически извлекается из текста

### weapons (оружие)

- **true** - упоминание оружия (нож, пистолет, бита и т.д.)
- **false** - оружие не упоминается

### recommended_department (рекомендуемое ведомство)

- **Полиция** - для большинства правонарушений
- **Скорая** - медицинские случаи, травмы
- **МЧС** - пожары, аварии, спасательные операции
- **Акимат** - административные вопросы, коммунальные проблемы

### summary (краткое описание)

- 1-2 предложения на языке звонка (русский/казахский)
- Содержит ключевые факты
- Генерируется ИИ на основе транскрипции

### needs_clarification (требуется уточнение)

- **true** - информации недостаточно, нужны дополнительные вопросы
- **false** - информации достаточно для классификации

### clarification_questions (вопросы для уточнения)

- Массив строк с вопросами на языке звонка
- Максимум 3 вопроса
- Пример: ["Не болды?", "Қай жерде?", "Қазір қауіп бар ма?"]

### confidence_score (уровень уверенности)

- Число от 0.0 до 1.0
- Рассчитывается на основе полноты информации
- > 0.8 - высокая уверенность
- 0.5-0.8 - средняя уверенность
- <0.5 - низкая уверенность, требуется проверка

### validated (валидировано)

- **true** - классификация проверена rule-based валидатором
- **false** - только результат ИИ без валидации

### validation_notes (заметки валидации)

- Массив строк с комментариями валидатора
- Пример: ["Адрес не указан - требуется уточнение", "Наличие оружия - требуется особое внимание"]

## Примеры

### Пример 1: Критический случай

```json
{
  "urgency": "critical",
  "category": "fire",
  "address": "ул. Толе би, д. 45",
  "current_danger": true,
  "people_involved": 3,
  "weapons": false,
  "recommended_department": "МЧС",
  "summary": "Горит квартира на третьем этаже, люди кричат из окон",
  "needs_clarification": false,
  "clarification_questions": []
}
```

### Пример 2: Средняя срочность

```json
{
  "urgency": "medium",
  "category": "theft",
  "address": "не указан",
  "current_danger": false,
  "people_involved": 1,
  "weapons": false,
  "recommended_department": "Полиция",
  "summary": "Украли сумку с документами в автобусе номер 12",
  "needs_clarification": true,
  "clarification_questions": ["Қай жерде?", "Қанша уақыт болды?"]
}
```

### Пример 3: Низкая срочность

```json
{
  "urgency": "low",
  "category": "noise",
  "address": "ул. Гоголя, д. 28",
  "current_danger": false,
  "people_involved": 2,
  "weapons": false,
  "recommended_department": "Полиция",
  "summary": "Соседи громко слушают музыку после 23:00",
  "needs_clarification": false,
  "clarification_questions": []
}
```

## Правила валидации

1. **Проверка обязательных полей** - все поля из основного формата должны присутствовать
2. **Корректность значений** - urgency и category должны быть из допустимых списков
3. **Логическая согласованность** - если current_danger=true, то urgency не может быть low
4. **Извлечение адреса** - при отсутствии адреса предпринимается попытка извлечь из текста
5. **Корректировка срочности** - на основе ключевых слов danger_indicators
6. **Определение оружия** - на основе weapon_indicators

## Использование в системе

1. ИИ анализирует транскрипцию и генерирует JSON
2. Классификатор валидирует и дополняет результат
3. Результат сохраняется в базу данных
4. Используется для:
   - Определения приоритета обработки
   - Маршрутизации в соответствующее ведомство
   - Отображения в дашборде оператора
   - Генерации отчетов

## Ограничения ИИ

ИИ НЕ ДОЛЖЕН:

- Давать юридические консультации
- Обещать помощь или вмешательство
- Оценивать ситуацию как эксперт
- Выражать эмоции или сочувствие
- Запрашивать личные данные (паспорт, ИИН и т.д.)

ИИ ДОЛЖЕН:

- Извлекать факты
- Классифицировать инциденты
- Определять срочность
- Заполнять JSON структуру
- Запрашивать уточнения при недостатке информации
