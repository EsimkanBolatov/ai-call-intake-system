# Демонстрационный сценарий работы AI Call Intake System

## 1. Обзор демонстрации

### Цель демонстрации

Показать полный цикл работы системы от входящего звонка до генерации структурированных данных для оператора.

### Ключевые моменты для демонстрации

1. **Автоответ системы** - мгновенный ответ на входящий звонок
2. **Качество распознавания речи** - точность STT на казахском/русском языках
3. **Интеллектуальный анализ** - способность ИИ извлекать ключевую информацию
4. **Классификация** - автоматическое определение срочности и категории
5. **Структурированный вывод** - генерация JSON с рекомендациями
6. **Логирование** - сохранение всех данных для последующего анализа

## 2. Полный демонстрационный сценарий

### Сценарий: Кража автомобиля

**Описание**: Звонящий сообщает о краже автомобиля со двора дома.

**Хронология событий**:

```
Время 10:00:00 - Входящий звонок на номер +77771234567
Время 10:00:02 - Asterisk принимает вызов, запускает AGI скрипт
Время 10:00:03 - Система отвечает: "102 қызметінің автоматты көмекшісісіз. Қысқаша не болғанын айтыңыз."
Время 10:00:10 - Звонящий: "Менің машинам ұрланды. Оны кеше кешке түнде ұрлап кетті."
Время 10:00:15 - STT преобразует аудио в текст с точностью 98%
Время 10:00:16 - LLM анализирует текст, задает уточняющий вопрос
Время 10:00:17 - Система: "Қай жерде болды?"
Время 10:00:22 - Звонящий: "Үй алдында, Абай көшесі 15."
Время 10:00:27 - LLM анализирует, задает следующий вопрос
Время 10:00:28 - Система: "Қазір қауіп бар ма?"
Время 10:00:32 - Звонящий: "Жоқ, бәрі тыныш."
Время 10:00:37 - LLM завершает анализ, генерирует JSON
Время 10:00:38 - TTS генерирует финальный ответ
Время 10:00:39 - Система: "Түсінікті. Деректеріңізді қабылдадық. Көмек жолдалады."
Время 10:00:42 - Звонок завершен, все данные сохранены
```

## 3. Генерируемые данные

### JSON результат от ИИ

```json
{
  "urgency": "high",
  "category": "vehicle_theft",
  "address": "Абай көшесі 15, үй алдында",
  "current_danger": false,
  "people_involved": 1,
  "weapons": false,
  "recommended_department": "ұрлық бөлімі, көліктер бөлімі",
  "summary": "Машина ұрланды, кеше түнде, қауіп жоқ, адрес бар",
  "timestamp": "2025-12-30T10:00:37Z",
  "call_id": "call_20251230_100000_77771234567",
  "confidence_score": 0.92
}
```

### Запись в базе данных

```sql
INSERT INTO calls VALUES (
  'call_20251230_100000_77771234567',
  '2025-12-30 10:00:00',
  '+77771234567',
  'Менің машинам ұрланды. Оны кеше кешке түнде ұрлап кетті. Үй алдында, Абай көшесі 15. Жоқ, бәрі тыныш.',
  '{"urgency": "high", "category": "vehicle_theft", "address": "Абай көшесі 15, үй алдында", "current_danger": false, "people_involved": 1, "weapons": false, "recommended_department": "ұрлық бөлімі, көліктер бөлімі", "summary": "Машина ұрланды, кеше түнде, қауіп жоқ, адрес бар", "timestamp": "2025-12-30T10:00:37Z", "call_id": "call_20251230_100000_77771234567", "confidence_score": 0.92}',
  '/var/spool/asterisk/monitor/20251230_100000_77771234567.wav',
  42.0,
  'completed'
);
```

### Файлы, созданные системой

```
/var/spool/asterisk/monitor/
├── 20251230_100000_77771234567.wav          # Полная запись звонка
├── 20251230_100000_77771234567_chunk1.wav   # Первая реплика
├── 20251230_100000_77771234567_chunk2.wav   # Вторая реплика
└── 20251230_100000_77771234567_chunk3.wav   # Третья реплика

/var/log/ai-call-intake/
├── agi.log                                   # Логи AGI скрипта
├── calls_fallback.log                       # Логи fallback вызовов
└── 2025-12-30_calls.csv                     # Экспорт звонков за день
```

## 4. Визуализация в Dashboard

### Главная панель Dashboard

```
┌─────────────────────────────────────────────────────────────┐
│                    AI CALL INTAKE DASHBOARD                 │
├─────────────────────────────────────────────────────────────┤
│ Последние звонки (5)                                        │
│ ┌─────┬────────────────┬──────────┬─────────┬─────────────┐│
│ │ №   │ Номер          │ Категория│ Срочность│ Время       ││
│ ├─────┼────────────────┼──────────┼─────────┼─────────────┤│
│ │ 1   │ +77771234567   │ vehicle  │ high    │ 10:00:00    ││
│ │     │                │ _theft   │         │             ││
│ ├─────┼────────────────┼──────────┼─────────┼─────────────┤│
│ │ 2   │ +77776543210   │ assault  │ critical│ 09:45:12    ││
│ ├─────┼────────────────┼──────────┼─────────┼─────────────┤│
│ │ 3   │ +77779876543   │ domestic │ medium  │ 09:30:45    ││
│ └─────┴────────────────┴──────────┴─────────┴─────────────┘│
│                                                             │
│ Статистика за сегодня                                       │
│ ┌─────────────────┬────────┬────────┬────────┬────────────┐│
│ │ Всего звонков   │ 12     │        │        │            ││
│ ├─────────────────┼────────┼────────┼────────┼────────────┤│
│ │ Критических     │ 2      │ 16.7%  │        │            ││
│ ├─────────────────┼────────┼────────┼────────┼────────────┤│
│ │ Высокой срочн.  │ 4      │ 33.3%  │        │            ││
│ ├─────────────────┼────────┼────────┼────────┼────────────┤│
│ │ Средней срочн.  │ 5      │ 41.7%  │        │            ││
│ ├─────────────────┼────────┼────────┼────────┼────────────┤│
│ │ Низкой срочн.   │ 1      │ 8.3%   │        │            ││
│ └─────────────────┴────────┴────────┴────────┴────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### Детальный просмотр звонка

```
┌─────────────────────────────────────────────────────────────┐
│ Детали звонка: call_20251230_100000_77771234567            │
├─────────────────────────────────────────────────────────────┤
│ Основная информация:                                        │
│ • Номер: +77771234567                                       │
│ • Время: 2025-12-30 10:00:00                               │
│ • Длительность: 42 секунды                                  │
│ • Язык: казахский                                           │
│ • Статус: завершен                                          │
│                                                             │
│ Транскрипт:                                                 │
│ [10:00:10] Система: 102 қызметінің автоматты көмекшісісіз. │
│            Қысқаша не болғанын айтыңыз.                     │
│ [10:00:15] Звонящий: Менің машинам ұрланды. Оны кеше кешке  │
│            түнде ұрлап кетті.                               │
│ [10:00:17] Система: Қай жерде болды?                        │
│ [10:00:22] Звонящий: Үй алдында, Абай көшесі 15.            │
│ [10:00:28] Система: Қазір қауіп бар ма?                     │
│ [10:00:32] Звонящий: Жоқ, бәрі тыныш.                       │
│ [10:00:39] Система: Түсінікті. Деректеріңізді қабылдадық.  │
│            Көмек жолдалады.                                 │
│                                                             │
│ Анализ ИИ:                                                  │
│ • Срочность: high                                           │
│ • Категория: vehicle_theft                                  │
│ • Адрес: Абай көшесі 15, үй алдында                         │
│ • Текущая опасность: нет                                    │
│ • Количество людей: 1                                       │
│ • Оружие: нет                                               │
│ • Рекомендуемое отделение: ұрлық бөлімі, көліктер бөлімі    │
│ • Уверенность: 92%                                          │
│                                                             │
│ Действия:                                                   │
│ [ ] Отправить в CRM                                         │
│ [ ] Уведомить оператора                                     │
│ [ ] Экспорт в PDF                                           │
│ [ ] Прослушать запись                                       │
└─────────────────────────────────────────────────────────────┘
```

## 5. Технические метрики демонстрации

### Производительность

```
Метрика                     Значение      Целевой показатель
─────────────────────────────────────────────────────────────
Время ответа системы        2 секунды     < 3 секунд
Точность STT                98%           > 95%
Время обработки LLM         1.5 секунды   < 3 секунд
Время генерации TTS         0.8 секунды   < 2 секунды
Общее время обработки       42 секунды    < 60 секунд
Использование CPU           15%           < 30%
Использование памяти        512 МБ        < 1 ГБ
```

### Надежность

- **Доступность системы**: 99.9% (запланированные простои только для обновлений)
- **Восстановление после сбоя**: < 30 секунд (автоматический перезапуск сервисов)
- **Резервное копирование данных**: ежечасно с хранением 30 дней
- **Мониторинг**: Real-time алерты при отклонении метрик

## 6. Демонстрация edge cases

### Сценарий 1: Тихий звонящий

```
[10:15:00] Входящий звонок
[10:15:02] Система: "102 қызметінің автоматты көмекшісісіз. Қысқаша не болғанын айтыңыз."
[10:15:12] Тишина 10 секунд
[10:15:14] Система: "Сіз бен байланыс жоқ. Қайта қоңырау шалыңыз."
[10:15:17] Звонок завершен
```

**Результат в БД**:

```json
{
  "urgency": "low",
  "category": "silent_call",
  "address": "",
  "current_danger": false,
  "people_involved": 0,
  "weapons": false,
  "recommended_department": "none",
  "summary": "Тихий звонок, ответа не последовало",
  "confidence_score": 0.0
}
```

### Сценарий 2: Эмоциональный звонящий

```
[10:30:00] Входящий звонок
[10:30:02] Система: "102 қызметінің автоматты көмекшісісіз. Қысқаша не болғанын айтыңыз."
[10:30:08] Звонящий (кричит): "КОМЕК КЕРЕК! ОЛ МЕНІ УРЫП ЖАТЫР!"
[10:30:12] Система (спокойно): "Қай жерде болып жатыр?"
[10:30:18] Звонящий: "ҮЙДЕ! 25-ҮЙ!"
[10:30:22] Система: "Қазір қауіп бар ма?"
[10:30:26] Звонящий: "ИЯ! ОЛ МЕНІМ АРТЫМДА!"
[10:30:30] Система: "Түсінікті. Көмек жолдалады."
```

**Результат в БД**:

```json
{
  "urgency": "critical",
  "category": "domestic_violence",
  "address": "25-үй",
  "current_danger": true,
  "people_involved": 2,
  "weapons": false,
  "recommended_department": "жедел бөлім, отбасылық қатынастар бөлімі",
  "summary": "Отбасылық зорлық-зомбылық, қазіргі уақытта қауіп бар",
  "confidence_score": 0.95
}
```

## 7. Интеграция с внешними системами

### Экспорт данных

```python
# Пример экспорта в CRM систему
def export_to_crm(call_data):
    crm_payload = {
        "case_type": call_data["category"],
        "priority": call_data["urgency"],
        "description": call_data["summary"],
        "location": call_data["address"],
        "caller_number": call_data["caller_number"],
        "timestamp": call_data["timestamp"],
        "ai_confidence": call_data["confidence_score"]
    }

    response = requests.post(
        "https://crm.example.com/api/cases",
        json=crm_payload,
        headers={"Authorization": f"Bearer {CRM_API_KEY}"}
    )

    return response.status_code == 201
```

### Уведомления оператора

```python
# Отправка уведомления в Telegram
def notify_operator(call_data):
    message = f"""
🚨 НОВЫЙ ЗВОНОК
Номер: {call_data['caller_number']}
Категория: {call_data['category']}
Срочность: {call_data['urgency']}
Адрес: {call_data['address']}
Опасность: {'ДА' if call_data['current_danger'] else 'нет'}

Транскрипт: {call_data['transcript'][:200]}...

Панель управления: http://dashboard.local/calls/{call_data['call_id']}
    """

    telegram.send_message(
        chat_id=OPERATOR_CHAT_ID,
        text=message,
        parse_mode="HTML"
    )
```

## 8. Валидация MVP требований

### Проверка выполнения всех требований

| Требование             | Статус       | Комментарий    |
| ---------------------- | ------------ | -------------- |
| Прием входящих звонков | ✅ Выполнено | Asterisk + SIP |
| Автоответ системы      | ✅ Выполнено | AGI скрипт     |
| STT преобразование     | ✅ Выполн    |
