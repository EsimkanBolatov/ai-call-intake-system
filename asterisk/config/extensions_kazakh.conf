;
; Asterisk extensions.conf - AI Call Intake System
; Казак тіліндегі конфигурация
; Өндіріс ортасы үшін
;

[general]
static=yes
writeprotect=no
clearglobalvars=no

; ============================================
; КОНТЕКСТТЕР
; ============================================

; Негізгі кіріс контексті
[incoming]
;
; Сыртқы қоңыраулар осы контекстке келеді
; SIP trunk арқылы
;

; 102 қызметінің нөміріне келетін қоңыраулар
exten => _102,1,NoOp(═► 102 қызметіне кіріс қоңырау)
 same => n,Answer()
 same => n,Wait(1)
 
 ; Қоңырауды жазу
 same => n,MixMonitor(${UNIQUEID}.wav,ab)
 
 ; AGI скриптіне жіберу
 same => n,AGI(agi://127.0.0.1/call_handler.py,${CALLERID(num)},kk)
 
 ; Қате жағдайда
 same => n,Hangup()

; Тест нөмірлері
exten => 500,1,NoOp(═► Ішкі тест қоңырауы)
 same => n,Answer()
 same => n,Wait(1)
 same => n,MixMonitor(${UNIQUEID}.wav,ab)
 same => n,AGI(agi://127.0.0.1/call_handler.py,${CALLERID(num)},kk)
 same => n,Hangup()

exten => 501,1,NoOp(═► Орыс тіліндегі тест)
 same => n,Answer()
 same => n,Wait(1)
 same => n,MixMonitor(${UNIQUEID}.wav,ab)
 same => n,AGI(agi://127.0.0.1/call_handler.py,${CALLERID(num)},ru)
 same => n,Hangup()

; Жалпы кіріс нөмірлері (кез келген нөмір)
exten => _X.,1,NoOp(═► Жалпы кіріс қоңырау)
 same => n,Answer()
 same => n,Wait(1)
 same => n,MixMonitor(${UNIQUEID}.wav,ab)
 
 ; Тілді автоматты анықтау
 same => n,Set(LANG=${IF($[ "${CALLERID(num):0:4}" = "+7777" ]?kk:ru)})
 same => n,AGI(agi://127.0.0.1/call_handler.py,${CALLERID(num)},${LANG})
 same => n,Hangup()

; ============================================
; ІШКІ ТЕСТ КОНТЕКСТІ
; ============================================

[internal-test]
;
; Ішкі тестілеу үшін
;

; Тест қоңырауы
exten => 500,1,NoOp(═► Ішкі тест қоңырауы басталуда)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Playback(hello-world)
 same => n,SayNumber(500)
 same => n,Wait(2)
 same => n,Hangup()

; AGI тесті
exten => 600,1,NoOp(═► AGI тесті)
 same => n,Answer()
 same => n,AGI(agi://127.0.0.1/call_handler.py,test_600,kk)
 same => n,Hangup()

; ============================================
; АУДИО ФАЙЛДАРЫ КОНТЕКСТІ
; ============================================

[audio-playback]
;
; Аудио файлдарын ойнату үшін
;

; Сәлемдесу
exten => welcome,1,NoOp(═► Сәлемдесу ойнатылуда)
 same => n,Answer()
 same => n,Playback(welcome-kk)
 same => n,Hangup()

; Түсінікті
exten => understood,1,NoOp(═► Түсінікті ойнатылуда)
 same => n,Answer()
 same => n,Playback(understood-kk)
 same => n,Hangup()

; Қайталаңыз
exten => repeat,1,NoOp(═► Қайталаңыз ойнатылуда)
 same => n,Answer()
 same => n,Playback(repeat-please-kk)
 same => n,Hangup()

; ============================================
; БАСҚАРУ КОНТЕКСТІ
; ============================================

[management]
;
; Жүйені басқару үшін
;

; Статус тексеру
exten => status,1,NoOp(═► Жүйе статусы)
 same => n,Answer()
 same => n,Playback(gsm/beep)
 same => n,SayNumber(${EPOCH})
 same => n,Wait(1)
 same => n,Hangup()

; Қоңыраулар саны
exten => count,1,NoOp(═► Қоңыраулар саны)
 same => n,Answer()
 same => n,AGI(agi://127.0.0.1/call_handler.py,status,kk)
 same => n,Hangup()

; ============================================
; ҚАТЕЛЕРДІ ӨҢДЕУ
; ============================================

[i]
; Қате нөмірлер
exten => i,1,NoOp(═► Қате нөмір)
 same => n,Answer()
 same => n,Playback(invalid)
 same => n,Wait(2)
 same => n,Hangup()

[t]
; Уақыт асып кету
exten => t,1,NoOp(═► Уақыт асып кетті)
 same => n,Playback(vm-goodbye)
 same => n,Hangup()

; ============================================
; МАКРОСЫ
; ============================================

[macro-handle-call]
;
; Қоңырауды өңдеу макросы
;
exten => s,1,NoOp(═► Қоңырау өңдеу басталды)
 same => n,Set(CALLERID=${ARG1})
 same => n,Set(LANGUAGE=${ARG2})
 
 ; Жазуды бастау
 same => n,MixMonitor(${UNIQUEID}.wav,ab)
 
 ; Деректерді AGI-ге жіберу
 same => n,AGI(agi://127.0.0.1/call_handler.py,${CALLERID},${LANGUAGE})
 
 ; Аяқтау
 same => n,Hangup()

; ============================================
; АУДИО ФАЙЛДАРЫНЫҢ ТІЗІМІ
; ============================================

; Казақ тіліндегі аудио файлдары:
; welcome-kk.gsm    - "102 қызметінің автоматты көмекшісісіз"
; understood-kk.gsm - "Түсінікті. Деректеріңізді қабылдадық"
; repeat-please-kk.gsm - "Қайталаңыз, түсінбедім"

; Орыс тіліндегі аудио файлдары:
; welcome-ru.gsm    - "Автоматический помощник службы 102"
; understood-ru.gsm - "Понятно. Ваши данные приняты"
; repeat-please-ru.gsm - "Повторите, не понял"

; ============================================
; АУДИО ФАЙЛДАРЫН ЖАСАУ СКРИПТІ
; ============================================

; Аудио файлдарын жасау үшін:
; text2wave -o welcome-kk.wav "102 қызметінің автоматты көмекшісісіз"
; sox welcome-kk.wav -r 8000 -c 1 welcome-kk.gsm
;
; text2wave -o understood-kk.wav "Түсінікті. Деректеріңізді қабылдадық"
; sox understood-kk.wav -r 8000 -c 1 understood-kk.gsm
;
; text2wave -o repeat-please-kk.wav "Қайталаңыз, түсінбедім"
; sox repeat-please-kk.wav -r 8000 -c 1 repeat-please-kk.gsm

; ============================================
; БҰЙРЫҚТАР
; ============================================

; Консольден қоңырау бастау:
; asterisk -rx "channel originate SIP/500 extension 500@internal-test"
;
; Статусты тексеру:
; asterisk -rx "core show channels"
; asterisk -rx "sip show peers"
;
; Қоңырауларды көру:
; asterisk -rx "core show calls"
;
; AGI статусы:
; asterisk -rx "agi show status"

; ============================================
; ЛОГТАУ
; ============================================

; Лог деңгейі:
; debug, notice, warning, error, dtmf, verbose
;
; Лог файлы: /var/log/asterisk/full
; AGI логтары: /var/log/asterisk/agi

; ============================================
; ҚАУІПСІЗДІК
; ============================================

; SIP authentication қатаң болуы керек
; RTP порттары: 10000-20000
; Firewall конфигурациясы:
;   - 5060/udp (SIP)
;   - 5060/tcp (SIP TLS)
;   - 10000:20000/udp (RTP)

; ============================================
; АЯҚТАУ
; ============================================

; Бұл конфигурация AI Call Intake System үшін
; Өндіріс ортасында қолдануға арналған
;
; Автор: AI Call Intake System
; Нұсқа: 1.0
; Күні: 2025-12-30